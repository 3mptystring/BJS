<template name="input">
    <div class="pages">
        <div data-page="index" class="page navbar-fixed toolbar-fixed">

            <div class="navbar">
                <div class="navbar-inner">
                    <div></div>
                    <div style="overflow-x: auto; overflow-y: hidden; text-align: center;" class="truncate">
                        <div id="input-name-swiper" class="swiper-container" style="height: 100%">
                            <div class="swiper-wrapper">
                                {{#each a in athletes}}
                                    <div class="swiper-slide open-popover athlete-name"
                                         data-popover=".popover-links">{{a.firstName}}&nbsp;{{a.lastName}}</div>
                                {{/each}}
                            </div>
                        </div>
                    </div>
                    <div></div>
                </div>
            </div>

            <div class="page-content">
                <div id="input-swiper" class="swiper-container" style="height: 100%;">
                    <div class="swiper-wrapper">
                        {{#each a in athletes}}
                            <div class="swiper-slide" data-hash="{{a.id}}"
                                 style="overflow-y: scroll; overflow-x: hidden;">
                                {{#with a}}
                                    {{#each s in sportType}}
                                        {{>attempts sportType=s}}
                                    {{/each}}
                                    {{#if isEmpty sportType}}
                                        <div class="content-block">
                                            <p style="text-align: center;">Wie es scheint haben wir bis jetzt keinerlei
                                                Messdaten.</p>
                                        </div>
                                    {{/if}}
                                    {{#if showCanNotDoSportType}}
                                        <div class="content-block">
                                            <div style="text-align: center;">Folgende Sportarten kann {{getFullName}} an
                                                dieser Station nicht durchführen:
                                            </div>
                                            {{#each n in canNotDoSportType}}
                                                <div style="text-align: center;">{{n}}</div>
                                            {{/each}}
                                            <br>
                                            <div style="text-align: center;">Dies liegt an dem Alter, dem Geschlecht
                                                oder der Startklasse.
                                            </div>
                                        </div>
                                    {{/if}}
                                {{/with}}
                            </div>
                        {{/each}}
                    </div>
                    <div class="swiper-pagination"></div>
                </div>
            </div>

            <div class="toolbar">
                <div class="toolbar-inner">
                    <a href="" id="link_prev" class="item-link hideOnMobile left">Vorheriger</a>
                    <div class="item-link center">
                        {{#if both_logged_in}}
                            <a href="#" class="logout-button">{{last_login}} abmelden</a>
                        {{else}}
                            <a href="#" class="return-to-login">Übersicht</a>
                        {{/if}}
                    </div>
                    <a href="" id="link_next" class="item-link hideOnMobile right">Nächster</a>
                </div>
            </div>
        </div>
    </div>

    {{>sportTypeDescriptions sportTypes=sportTypes}}

    <div class="popover popover-links">
        <div class="popover-angle"></div>
        <div class="popover-inner">
            <div class="list-block athletes-list" style="max-height: 75%; overflow-y: scroll;">
                <ul>
                    {{#each athletes}}
                        <li><a href="#" class="list-button item-link athlete-link"
                               data-target="{{@index}}">{{this.firstName}}&nbsp;{{this.lastName}}</a></li>
                    {{/each}}
                </ul>
            </div>
        </div>
    </div>

    <style>
        .athletes-list::-webkit-scrollbar {
            width: 0px; /* remove scrollbar space */
            background: transparent; /* optional: just make scrollbar invisible */
        }
        @media screen and (max-width: 480px) {
            .hideOnMobile {
                opacity: 0;
            }
        }

        .truncate {
            width: 250px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .athlete-name:hover {
            border-bottom-color: #B0BEC5;
            cursor: pointer;
        }

        .athlete-name {
            border-bottom: 2px solid transparent;
            text-decoration: none;
            transition: border-bottom-color 50ms linear 0s;
        }

    </style>
</template>

<template name="sportTypeDescriptions">
    {{#each s in sportTypes}}
        {{#with s}}
            <div class="popup popup-{{id}}">
                <div class="content-block">
                    <a href="#" class="close-popup"><i class="f7-icons vcenterIcon link"
                                                       style="float: left;">chevron_left</i></a>
                    <h1 style="text-align: center;">{{name}}</h1>
                    <h5 style="text-align: center">Einheit: {{unit}}</h5>
                    <p id="description" style="text-align: justify">{{{description}}}</p>
                    <!--Three { are required for html Tags!-->
                    {{#with m}}
                        {{#each a in age}}
                            {{a}}
                        {{/each}}
                    {{/with}}
                    <!-- TODO Add female participant age and display it and the one for males in a meaningful manner instead of just listing them -->
                </div>
            </div>
        {{/with}}
    {{/each}}
    <style>
        .vcenterIcon {
            height: 39px;
            line-height: 39px;
            text-align: center;
        }

        #description img {
            display: block;
            margin: auto;
        }
    </style>
</template>

<template name="attempts">
    {{#with sportType}}
        <div class="content-block-title" data-swiper-parallax="-100" data-swiper-parallax-duration="500">
            <a href="#" data-popup=".popup-{{name}}" class="link-open-st-info open-popup">
                {{#with metadata}}{{name}}{{/with}} <i class="f7-icons" style="font-size: 12px">info</i>
            </a>
        </div>
        <div class="list-block">
            <ul>
                {{#each m in measurements}}
                    {{>attempt n=@index measurement=m metadata=metadata}}
                {{/each}}
                {{#if scoreWritePermission metadata}}
                    {{>attempt n=(length measurements) measurement=empty_measurement metadata=metadata}}
                {{/if}}
            </ul>
        </div>
    {{/with}}
</template>

<template name="attempt">
    <li>
        <div class="item-content">
            <div class="item-inner">
                <div class="item-title label">{{inc n}}. Versuch</div>
                <div class="item input">
                    <input type="{{#with metadata}}{{inputType}}{{/with}}"
                           placeholder="Ergebnis in {{#with metadata}}{{unit}}{{/with}}"
                           value="{{#with measurement}}{{strValue}}{{/with}}"
                           data-attempt="{{inc n}}"
                           data-stID="{{#with metadata}}{{id}}{{/with}}"
                           class="{{#with measurement}}{{class}}{{/with}}"
                        {{isReadOnly measurement}}
                    >
                </div>
            </div>
        </div>
    </li>
</template>